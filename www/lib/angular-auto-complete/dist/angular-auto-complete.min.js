!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["module","angular"],function(n,t){n.exports=e(t)}):e(n.angular)}(this,function(n){"use strict";function e(e,o,s,c,l){function u(t,u,d,p){function f(e){e=e||{},T.init(n.extend({},a,e)),m(),C()}function m(){T.container=h(),T.options.containerCssClass&&T.container.addClass(T.options.containerCssClass),T.options.dropdownParent?T.options.dropdownParent.append(T.container):(s.find("body").append(T.container),T.container.addClass("auto-complete-absolute-container")),T.elementUL=n.element(T.container[0].querySelector("ul.auto-complete-results"))}function h(){return n.isElement(T.options.dropdownParent)?g():v()}function g(){var n=T.options.dropdownParent;n.addClass("auto-complete-container unselectable"),n.attr("data-instance-id",T.instanceId);var e=o(w()),i=e(t);return n.append(i),n}function v(){return o(I())(t)}function I(){var n="";return n+='<div class="auto-complete-container unselectable"',n+='     data-instance-id="{{ ctrl.instanceId }}"',n+='     ng-show="ctrl.containerVisible">',n+=w(),n+="</div>"}function w(){var n="";return n+='     <ul class="auto-complete-results">',n+='         <li ng-repeat="item in ctrl.renderItems track by $index"',n+='             ng-click="ctrl.selectItem($index, true)"',n+='             class="auto-complete-item" data-index="{{ $index }}"',n+='             ng-class="ctrl.getSelectedCssClass($index)">',n+='               <div ng-bind-html="item.label"></div>',n+="         </li>",n+="     </ul>"}function C(){function e(n){return-1!==[r.TAB,r.ALT,r.CTRL,r.LEFTARROW,r.RIGHTARROW,r.MAC_COMMAND_LEFT,r.MAC_COMMAND_RIGHT].indexOf(n)}function o(n){var t=n.charCode||n.keyCode||0;if(!e(t))return t===r.UPARROW?(T.scrollToPreviousItem(),n.stopPropagation(),void n.preventDefault()):t===r.DOWNARROW?(T.scrollToNextItem(),n.stopPropagation(),void n.preventDefault()):t===r.ENTER?(T.selectItem(T.selectedIndex,!0),n.preventDefault(),void n.stopPropagation()):t===r.ESCAPE?(T.restoreOriginalText(),T.autoHide(),n.preventDefault(),void n.stopPropagation()):void 0}function a(n){if(!n||n.length<T.options.minimumChars)return void T.autoHide();d(n)}function d(n,e){var t=l(function(){n===u.val()&&T.query(n),l.cancel(t)},e||300)}function p(){i.hideAllInactive()}function f(n){if(i.hideAllInactive(),!T.isInline()&&T.container)return n.target===T.target[0]?void n.stopPropagation():x(n.target)?void n.stopPropagation():void T.autoHide()}u.on("focus",function(){t.$evalAsync(function(){T.activate(),T.options.activateOnFocus&&d(u.val(),100)})}),u.on("input",function(){t.$evalAsync(function(){a(u.val())})}),u.on("keydown",function(n){var e=n;t.$evalAsync(function(){o(e)})}),T.container.find("ul").on("scroll",function(){if(T.options.pagingEnabled){var n=this;t.$evalAsync(function(){T.containerVisible&&n.offsetHeight+n.scrollTop>=n.scrollHeight&&T.tryLoadNextPage()})}}),s.on("keydown",function(n){t.$evalAsync(function(){p()})}),n.element(c).on("resize",function(){T.options.hideDropdownOnWindowResize&&t.$evalAsync(function(){T.autoHide()})}),s.on("click",function(n){var e=n;t.$evalAsync(function(){f(e)})})}function x(e){return!(!n.isFunction(T.container[0].contains)||!T.container[0].contains(e))||!!(window.jQuery&&n.isFunction(T.container.has)&&T.container.has(e).length>0)}var T=p[0];T.textModelCtrl=p[1],i.addDirectiveCtrl(T),T.target=u,l(function(){e.when(T.initialOptions()).then(f)});var y=t.$on("$destroy",function(){T.container&&(T.container.remove(),T.container=null),y()})}return{restrict:"A",scope:{},transclude:!1,controllerAs:"ctrl",bindToController:{initialOptions:"&autoComplete"},require:["autoComplete","ngModel"],link:u,controller:t}}function t(e,t,o,r,s,c,l,u){function d(){return p(M,N+1)}function p(n,e){var t={searchText:n,paging:{pageIndex:e,pageSize:W.options.pageSize},queryId:++S};return f(t,(W.options.pagingEnabled?R:b).bind(W,t))}function f(n,t){return M=n.searchText,U=!0,g(W.options.loading),e.when(W.options.data(n.searchText,n.paging),function(e){if(A(n,e))return void W.autoHide();t(e).then(W.show),g(W.options.loadingComplete)},function(n){W.autoHide(),g(W.options.loadingComplete,{error:n})}).then(function(){U=!1})}function m(n){var e=W.selectedIndex+n;return e>=W.renderItems.length?-1:e}function h(n){if(W.containerVisible){W.selectItem(n);var e='li[data-index="'+n+'"]';if(window.jQuery&&window.jQuery.scrollTo)return void W.elementUL.scrollTo(W.elementUL.find(e));var t=W.elementUL[0].querySelector(e);t&&(W.elementUL[0].scrollTop=t.offsetTop)}}function g(e,t){if(n.isFunction(e))try{return e.call(W.target,t)}catch(n){}}function v(){if(!W.isInline()){if("auto"===W.options.dropdownWidth){var n=W.target[0].getBoundingClientRect();W.container.css({width:n.width+"px"})}else W.container.css({width:W.options.dropdownWidth});"auto"!==W.options.dropdownHeight&&W.elementUL.css({"max-height":W.options.dropdownHeight}),W.options.positionUsingJQuery&&I()?w():C()}}function I(){return window.jQuery&&window.jQuery.ui}function w(){var e={my:"left top",at:"left bottom",of:W.target,collision:"none flip"},t=n.extend({},e,W.options.positionUsing);W.containerVisible||W.container.css({visibility:"hidden"}),W.containerVisible=!0,s(function(){W.container.position(t),W.container.css({visibility:"visible"})})}function C(){var n=W.target[0].getBoundingClientRect(),e=o[0].body.scrollTop||o[0].documentElement.scrollTop||t.pageYOffset,i=o[0].body.scrollLeft||o[0].documentElement.scrollLeft||t.pageXOffset;W.container.css({left:n.left+i+"px",top:n.top+n.height+e+"px"}),W.containerVisible=!0}function x(){var n=W.renderItems[W.selectedIndex];n&&T(n.value)}function T(n){W.target.val(n),W.textModelCtrl.$setViewValue(n)}function y(){!W.isInline()&&W.containerVisible&&(W.containerVisible=!1,W.empty(),L(),g(W.options.dropdownHidden))}function A(n,e){return n.queryId!==S||!(e&&0!==e.length||W.options.pagingEnabled&&0!==n.paging.pageIndex)}function b(n,e){return O().then(function(n){e&&0!==e.length&&(W.renderItems=$(n,e))})}function R(e,t){return O().then(function(o){if(t&&0!==t.length){var i=$(o,t);n.forEach(i,function(n){W.renderItems.push(n)}),N=e.paging.pageIndex,V=i.length<W.options.pageSize}})}function $(e,t){var o=t.length<W.options.maxItemsToRender?t.length:W.options.maxItemsToRender,i=t.slice(0,o),r=[];return n.forEach(i,function(n){var t=e(n);t&&t.label&&t.value&&(t.data=n,r.push(t))}),r}function O(){if(n.isFunction(W.options.renderItem)&&W.options.renderItem!==n.noop)return e.when(W.options.renderItem);if(W.options.itemTemplateUrl)return E();var t=W.options.itemTemplate||"<span>{{item}}</span>";return e.when(H.bind(null,c(t,!1)))}function E(){return l(W.options.itemTemplateUrl).then(function(n){return H.bind(null,c(n,!1))}).catch(u)}function H(e,t){return{value:n.isObject(t)&&W.options.selectedTextAttr?t[W.options.selectedTextAttr]:t,label:r.trustAsHtml(e({item:t}))}}function P(){return W.options.pagingEnabled&&!U&&!V}function D(n){return!!P()&&n>=W.renderItems.length-W.options.invokePageLoadWhenItemsRemaining-1}function L(){M=null,N=0,V=!1}var W=this,M=null,S=0,U=!1,V=!1,N=0;this.target=null,this.instanceId=-1,this.selectedIndex=-1,this.renderItems=[],this.containerVisible=!1,this.isInline=function(){return n.isElement(W.options.dropdownParent)},this.init=function(n){W.instanceId=i.getNewInstanceId(),W.options=n,W.containerVisible=W.isInline(),g(W.options.ready,q)},this.activate=function(){i.setActiveInstanceId(W.instanceId),M=null},this.query=function(n){return W.empty(),L(),p(n,0)},this.show=function(){v(),g(W.options.dropdownShown)},this.positionDropdownIfVisible=function(){W.containerVisible&&v()},this.autoHide=function(){W.options.autoHideDropdown&&y()},this.empty=function(){W.selectedIndex=-1,W.renderItems=[]},this.restoreOriginalText=function(){M&&T(M)},this.scrollToPreviousItem=function(){var n=m(-1);-1!==n&&h(n)},this.scrollToNextItem=function(){var n=m(1);-1!==n&&(h(n),D(n)&&d())},this.selectItem=function(n,e){var t=W.renderItems[n];t&&(W.selectedIndex=n,x(),e&&(W.autoHide(),g(W.options.itemSelected,{item:t.data})))},this.getSelectedCssClass=function(n){return n===W.selectedIndex?W.options.selectedCssClass:""},this.tryLoadNextPage=function(){P()&&d()};var q=function(){return{setOptions:function(e){e&&n.forEach(e,function(n,e){a.hasOwnProperty(e)&&(W.options[e]=n)})},positionDropdown:W.positionDropdownIfVisible,hideDropdown:y}}()}function o(){var e=this,t=[],o=0,i=0;this.addDirectiveCtrl=function(n){n&&t.push(n)},this.getNewInstanceId=function(){return o++},this.setActiveInstanceId=function(n){i=n,e.hideAllInactive()},this.hideAllInactive=function(){n.forEach(t,function(n){n.instanceId!==i&&n.autoHide()})}}var i=new o;n.module("autoCompleteModule",["ngSanitize"]).directive("autoComplete",e),e.$inject=["$q","$compile","$document","$window","$timeout"],t.$inject=["$q","$window","$document","$sce","$timeout","$interpolate","$templateRequest","$exceptionHandler"];var r={TAB:9,ENTER:13,CTRL:17,ALT:18,ESCAPE:27,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,MAC_COMMAND_LEFT:91,MAC_COMMAND_RIGHT:93},a={containerCssClass:null,selectedCssClass:"auto-complete-item-selected",minimumChars:1,maxItemsToRender:20,activateOnFocus:!1,dropdownWidth:"auto",dropdownHeight:"auto",dropdownParent:null,selectedTextAttr:null,itemTemplate:null,itemTemplateUrl:null,pagingEnabled:!1,pageSize:5,invokePageLoadWhenItemsRemaining:1,positionUsingJQuery:!0,positionUsing:null,autoHideDropdown:!0,hideDropdownOnWindowResize:!0,ready:n.noop,loading:n.noop,data:n.noop,loadingComplete:n.noop,renderItem:n.noop,itemSelected:n.noop,dropdownShown:n.noop,dropdownHidden:n.noop}});